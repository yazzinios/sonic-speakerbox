services:

  sonicbeat:
    build:
      context: .
      args:
        VITE_SUPABASE_PROJECT_ID: "${VITE_SUPABASE_PROJECT_ID}"
        VITE_SUPABASE_PUBLISHABLE_KEY: "${VITE_SUPABASE_PUBLISHABLE_KEY}"
        VITE_SUPABASE_URL: "${VITE_SUPABASE_URL}"
    container_name: sonicbeat
    ports:
      - "8083:80"
    restart: always
    networks:
      sonicbeat-net:
        ipv4_address: 10.10.0.2
    depends_on:
      - radio-server

  radio-server:
    build:
      context: ./streaming-server
    container_name: radio-server
    ports:
      - "8000:8000"   # Icecast — listeners connect here directly
                      # URL: http://YOUR_SERVER_IP:8000/deck-a
      # Node.js API (port 3001) is NOT exposed directly — all traffic
      # goes through nginx on port 8083 which proxies /api/ → radio-server:3001
    environment:
      ICECAST_HOST: "localhost"
      ICECAST_PORT: "8000"
      ICECAST_SOURCE_PASSWORD: "${ICECAST_SOURCE_PASSWORD:-sonicbeat_source_2024}"
      ICECAST_ADMIN_PASSWORD: "${ICECAST_ADMIN_PASSWORD:-sonicbeat_admin_2024}"
      UPLOAD_DIR: "${UPLOAD_DIR:-/data/uploads}"
      LIQ_HOST: "localhost"
      LIQ_TELNET_PORT: "1234"
      LIQ_HARBOR_PORT: "8005"
    volumes:
      - sonicbeat-uploads:/data
    restart: always
    networks:
      sonicbeat-net:
        ipv4_address: 10.10.0.3

networks:
  sonicbeat-net:
    name: sonicbeat-net
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.0.0/24
          gateway: 10.10.0.1

volumes:
  sonicbeat-uploads:
    name: sonicbeat-uploads
